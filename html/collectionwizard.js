var CollectionWizard=new Class({Binds:["send","show","checked"],initialize:function(a){this.element=a;$$("#ctrl_"+a+" .jserror").setStyle("display","none");$$("#ctrl_"+a+" .search").setStyle("display","table-row");$$("#ctrl_"+a+" tbody tr").each(function(b){var c=b.getElement("input[type=checkbox]");if(c){c.addEvent("change",function(b){b.target.getParent("tr").destroy();$("ctrl_"+a).send()})}});$("ctrl_"+a).set("send",{method:"get",link:"cancel",onSuccess:this.show});$$("#ctrl_"+this.element+" .search input.tl_text").addEvent("keyup",this.send)},send:function(){clearTimeout(this.timer);this.timer=setTimeout(function(){$$("#ctrl_"+this.element+" .search input.tl_text").setStyle("background-image","url(system/modules/collectionwizard/html/loading.gif)");$("ctrl_"+this.element).send(window.location.href+"&productCollectionWizard="+this.element)}.bind(this),300)},show:function(a){var b;try{b=JSON.decode(a);if(b.token){AjaxRequest.updateTokens(b.token)}a=b.content}catch(c){}$$("#ctrl_"+this.element+" .search input.tl_text").setStyle("background-image","none");$$("#ctrl_"+this.element+" tr.found").each(function(a){a.destroy()});var d=Elements.from(a,false);$$("#ctrl_"+this.element+" tbody").adopt(d);d.each(function(a){var b=a.getElement("input[type=checkbox]");if(b)b.addEvent("change",this.checked)}.bind(this))},checked:function(a){if(a.target.checked){var b=$$("#ctrl_"+this.element+" tbody tr.existing").length;var c=a.target.getParent("tr");var d=c.getElement("select[class=tl_select]");var e=c.getElement("input[name=products-qty]");var f=c.getElement("input[name=products-price]");c.removeClass("found").inject($$("#ctrl_"+this.element+" tr.search")[0],"before").addClass("existing");a.target.set("name","products["+b+"][product]");if(d){d.set("name","products["+b+"][options]")}e.set("name","products["+b+"][qty]");f.set("name","products["+b+"][price]")}else{a.target.getParent("tr").destroy();$("ctrl_"+this.element).send()}}})